version: "3.7"
services:
  server:
    container_name: whitefalcon
    restart: always
    build:
      args:
        - DNS_RESOLVER=127.0.0.11
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:80"
    networks:
      - whitefalcon-network
    volumes:
      - ./nginx-dev.conf.tmpl:/usr/local/openresty/nginx/conf/nginx.conf
      - ./openresty-admin/public:/usr/local/openresty/nginx/html/openresty-admin/public
      - ./openresty-admin/src:/usr/local/openresty/nginx/html/openresty-admin/src
      - ./openresty-admin/.eslintrc.cjs:/usr/local/openresty/nginx/html/openresty-admin/.eslintrc.cjs
      - ./openresty-admin/.gitignore:/usr/local/openresty/nginx/html/openresty-admin/.gitignore
      - ./openresty-admin/index.html:/usr/local/openresty/nginx/html/openresty-admin/index.html
      - ./openresty-admin/package.json:/usr/local/openresty/nginx/html/openresty-admin/package.json
      - ./openresty-admin/vite.config.js:/usr/local/openresty/nginx/html/openresty-admin/vite.config.js
      - ./openresty-admin/yarn.lock:/usr/local/openresty/nginx/html/openresty-admin/yarn.lock
      - ./data:/usr/local/openresty/nginx/html/data
      - ./api:/usr/local/openresty/nginx/html/api
    environment:
      LUA_DEBUG: "true"
      REDIS_HOST: "whitefalcon-redis"
      APP_NAME: "whitefalcon"
      VERSION: "1.0"
      STACK: "Lua 5.1"
      DEPLOYMENT_TIME: "20230510055429"
#      DNS_RESOLVER: "127.0.0.11"       # Docker's internal DNS resolver IP this should only be added for Docker deployments

  redis:
    container_name: whitefalcon-redis
    image: "redis:alpine"
    ports:
      - "6379:6379"
    networks:
      - whitefalcon-network

networks: 
  whitefalcon-network: